---
# Interactive inputs for platform selection
- name: Block for sap_vm_provision_iac_type
  when: sap_vm_provision_iac_type is not defined or not sap_vm_provision_iac_type
  block:
    - name: Interactive input - sap_vm_provision_iac_type
      ansible.builtin.pause:
        prompt: |
          Please choose Infrastructure-as-Code automation from list: ansible , ansible_to_terraform
          (for existing_hosts, use Ansible standard execution with an Ansible Extravars file)
      register: sap_vm_provision_iac_type_register
      when: sap_vm_provision_iac_type is not defined or not sap_vm_provision_iac_type

    - name: Set fact for sap_vm_provision_iac_type
      ansible.builtin.set_fact:
        sap_vm_provision_iac_type: "{{ sap_vm_provision_iac_type_register.user_input }}"


- name: Block for sap_vm_provision_iac_platform
  when: sap_vm_provision_iac_platform is not defined or not sap_vm_provision_iac_platform
  block:
    - name: Interactive input - sap_vm_provision_iac_platform
      ansible.builtin.pause:
        prompt: |
          Please choose Infrastructure Platform from list:
          aws_ec2_vs , gcp_ce_vm , ibmcloud_powervs , ibmcloud_vs , ibmpowervm_vm , kubevirt_vm , msazure_vm , ovirt_vm
      register: sap_vm_provision_iac_platform_register
      when: sap_vm_provision_iac_platform is not defined or not sap_vm_provision_iac_platform

    - name: Set fact for sap_vm_provision_iac_platform
      ansible.builtin.set_fact:
        sap_vm_provision_iac_platform: "{{ sap_vm_provision_iac_platform_register.user_input }}"


# Interactive inputs for specific type
- name: Interactive input - Gather variables for specific type
  ansible.builtin.include_tasks:
    file: "../../tasks/interactive_type_select.yml"
  when: interactive_input_type


# Interactive inputs for specific platform
- name: Check that provided {{ sap_vm_provision_iac_platform }} has task file
  ansible.builtin.stat:
    path: "../../tasks/interactive_{{ sap_vm_provision_iac_platform }}.yml"
  register: __iac_platform_task_file
  ignore_errors: true

- name: Interactive input - Trigger prompts for VM provisioning via {{ sap_vm_provision_iac_platform }}
  ansible.builtin.include_tasks:
    file: "../../tasks/interactive_{{ sap_vm_provision_iac_platform }}.yml"
  when: __iac_platform_task_file.stat.exists


# Interactive inputs for all scenarios
- name: Block for sap_vm_provision_dns_root_domain
  when: sap_vm_provision_dns_root_domain is not defined or not sap_vm_provision_dns_root_domain
  block:
    - name: Interactive input - sap_vm_provision_dns_root_domain
      ansible.builtin.pause:
        prompt: |
          Please enter DNS domain for fully qualified domain name (FQDN).
          Example: example.com
      register: sap_vm_provision_dns_root_domain_register
      no_log: true

    - name: Set fact for sap_vm_provision_dns_root_domain
      ansible.builtin.set_fact:
        sap_vm_provision_dns_root_domain: "{{ sap_vm_provision_dns_root_domain_register.user_input }}"

- name: Block for sap_install_media_detect_source_directory
  when: sap_install_media_detect_source_directory is not defined or not sap_install_media_detect_source_directory
  block:
    - name: Interactive input - sap_install_media_detect_source_directory
      ansible.builtin.pause:
        prompt: |
          Please enter location of SAP installation media.
          Default: /software
      register: sap_install_media_detect_source_directory_register
      no_log: true

    - name: Set fact for sap_install_media_detect_source_directory
      ansible.builtin.set_fact:
        sap_install_media_detect_source_directory:
          "{{ sap_install_media_detect_source_directory_register.user_input | d('/software') }}"

- name: Block for sap_id_user
  when: sap_id_user is not defined or not sap_id_user
  block:
    - name: Interactive input - sap_id_user
      ansible.builtin.pause:
        prompt: "Please enter SAP S-User ID for downloading SAP installation media using sap_launchpad."
      register: sap_id_user_register
      no_log: true

    - name: Set fact for sap_id_user
      ansible.builtin.set_fact:
        sap_id_user: "{{ sap_id_user_register.user_input }}"

- name: Block for sap_id_user_password
  when: sap_id_user_password is not defined or not sap_id_user_password
  block:
    - name: Interactive input - sap_id_user_password
      ansible.builtin.pause:
        prompt: "Please enter SAP S-User Password for downloading SAP installation media using sap_launchpad."
      register: sap_id_user_password_register
      no_log: true

    - name: Set fact for sap_id_user_password
      ansible.builtin.set_fact:
        sap_id_user_password: "{{ sap_id_user_password_register.user_input }}"
